// Create an iframe based on config
if (xSell && xSell.hasOwnProperty('widgetTarget')) {

    var container = document.getElementById(xSell.widgetTarget),
        iframeHost = 'https://widgets.hotels.com'
        iframePage = '/getXsellWidget';

    if (container) {
        var iframe = document.createElement('iframe');
        iframe.id = 'hotels-iframe';
        iframe.src = iframeHost + iframePage + '?';
        for (var key in xSell) {
            if (xSell.hasOwnProperty(key)) {
                iframe.src += encodeURIComponent(key) + '=' + encodeURIComponent(xSell[key]) + '&';
            }
        }
        iframe.src += '#location=' + encodeURIComponent(self.location.href);
        iframe.setAttribute('allow', 'geolocation');
        iframe.setAttribute('scrolling', 'no');
        iframe.setAttribute('frameborder', '0');
        iframe.setAttribute('width', '100%'); // Required for IE9
        iframe.setAttribute('height', '520');
        iframe.setAttribute('title', 'hotel deals');
        // Setting the default height to match actual content to avoid jumping while the page loads
        iframe.style = 'overflow: hidden; border: 0; margin: 0; padding: 0; height: 520px; width: 100%; transition: height 0.3s ease-in-out;';
        container.appendChild(iframe);

        // Get iframe height via postMessage and resize the iframe accordingly
        var handleIframeResize = function (event) {
            if (event.origin === iframeHost) {
                iframe.style.height = parseInt(event.data, 10) + "px";
            }
        };
        if (window.addEventListener) {
            window.addEventListener('message', handleIframeResize, false);
        } else if (window.attachEvent) {
            window.attachEvent('onmessage', handleIframeResize);
        }
    }
}